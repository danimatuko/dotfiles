#!/usr/bin/env bash
# Theme switcher script with theme existence check

LIGHT_THEME="Adwaita"
DARK_THEME="Adwaita-dark"
ICON_THEME="Adwaita"

CURRENT_THEME=$(gsettings get org.gnome.desktop.interface gtk-theme | tr -d "'")

LIGHT_ICON="weather-clear"
DARK_ICON="weather-clear-night"
NOTIFICATION_TIMEOUT=3000

# Function to check if theme exists
theme_exists() {
    local theme="$1"
    [[ -d "/usr/share/themes/$theme" || -d "$HOME/.themes/$theme" ]]
}

if [[ "$CURRENT_THEME" == "$DARK_THEME" ]]; then
    if theme_exists "$LIGHT_THEME"; then
        gsettings set org.gnome.desktop.interface gtk-theme "$LIGHT_THEME"
        gsettings set org.gnome.desktop.interface icon-theme "$ICON_THEME"
        gsettings set org.gnome.desktop.interface color-scheme "default"
        notify-send --icon="$LIGHT_ICON" --expire-time="$NOTIFICATION_TIMEOUT" \
            "Theme Changed" "Switched to Light Mode (${LIGHT_THEME})"
    else
        notify-send --icon=dialog-warning "Theme Switch Failed" \
            "Light theme (${LIGHT_THEME}) is not installed!"
    fi
else
    if theme_exists "$DARK_THEME"; then
        gsettings set org.gnome.desktop.interface gtk-theme "$DARK_THEME"
        gsettings set org.gnome.desktop.interface icon-theme "$ICON_THEME"
        gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"
        notify-send --icon="$DARK_ICON" --expire-time="$NOTIFICATION_TIMEOUT" \
            "Theme Changed" "Switched to Dark Mode (${DARK_THEME})"
    else
        notify-send --icon=dialog-warning "Theme Switch Failed" \
            "Dark theme (${DARK_THEME}) is not installed!"
    fi
fi
